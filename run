#!/usr/bin/env python3

import sys
import os
import subprocess

def main():
    if len(sys.argv) < 2:
        print("Error: No mode specified.")
        return 1

    try:
        with open(os.getenv("LOG_FILE"), "w") as f:
            pass
    except:
        # No log file was provided or it couldn't be opened
        pass

    mode = sys.argv[1]
    if mode == "install":
        # INSTALL DEPENDENCIES
        ret_val = subprocess.run("npm install", shell=True)
        if ret_val.returncode != 0:
            print("Error: Install failed")
            return 1
        return 0

    elif mode == "build":
        # BUILD PROJECT
        ret_val = subprocess.run("tsc src/*.ts", shell=True)
        if ret_val.returncode != 0:
            print("Error: Build failed")
            return 1
        return 0

    elif mode == "test":
        # RUN TESTS
        # TODO: Add code to run tests
        pass
    else:
        # RANK MODULES
        if len(sys.argv) < 2:
            print("Arg 1 needs to be URL to input file or one of")
            return 1

        file_path = sys.argv[1]

        try:
            file = open(file_path, "r")
        except FileNotFoundError:
            print(f"Error: File not found at path: {file_path}")
            return 1

        with file:
            for line in file:
                # remove newline character from the end of the line
                line = line.strip()

                # create the command string
                command = f"node src/main.js {line}"

                # call main with each URL as argument
                # print(f"Running command -> {command}")
                subprocess.run(command, shell=True)


if __name__ == "__main__":
    main()